<html
  tal:define="dummy view/trigger_sec">
  <head>
    <title>add new thread or comment</title>
  </head>
  <body>
    <script type="text/javascript">
    // <![CDATA[
    function add_smiley(text_to_add) {
        /* add a smiley to the topic
        */
        // XXX this is a bit scary... the DOM specs say text nodes can
        // be split up, but afaik that never happens in browsers... if,
        // however, people start reporting missing last bits of text, please
        // fix this code... ;)
        var topic = document.getElementById('topic');
        var content = topic.value;
        var lastchar = content.charAt(content.length - 1);
        if (lastchar && lastchar != ' ' && lastchar != '\t' && lastchar != '\n'
              && lastchar != '\r') {
            content += ' ';
        };
        content += text_to_add + ' ';
        // XXX please check the argument order here! might be wrong...
        topic.value = content;
        topic.focus();
    };

    // ]]>
    </script>
    <form id="forum-thread-form"
      method="post"
      tal:attributes="action context/absolute_url">
      <h3>Post a new topic</h3>
      <h5>Subject</h5>
      <div class="feedback"
        tal:condition="python:request.get('preview') and request.get('text') and
                       not request.get('topic')">
        <span class="warning">Please provide a subject for the new topic.</span>
      </div>
      <div class="subject-input">
        <input class="store"
          type="text"
          name="topic"
          id="topic"
          size="80"
          tal:attributes="value request/topic | nothing"
        />
      </div>
      <div id="emoticons">
        <div class="emoticon" tal:repeat="smileydata view/get_smiley_data">
          <img onclick="add_smiley(this.title)"
            alt="emoticon"
            tal:attributes="title smileydata/text; src smileydata/href"
          />
        </div>
      </div>
      <div class="submit">
        <input style="float:right"
          type="submit"
          value="add topic"
        />
        <input type="submit"
          name="preview"
          value="preview"
        />
      </div>
    </form>
  </body>
</html>
